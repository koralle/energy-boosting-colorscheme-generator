# エネルギーUP色鑑定システム - 実装計画

## 概要

占い師がブラウザ上で鑑定パターンを選択するだけで「エネルギーUP色」の鑑定書の雛形を素早く生成・印刷できるWebシステムを開発します。

## 鑑定書のレイアウト（現行仕様に基づく）

### 構成要素
1. **ヘッダー部**
   - タイトル（エネルギーUP色）
   - 顧客氏名・生年月日（手書き用下線）
   - 十二支アイコン（右上八角形）

2. **中央メイン部**
   - 放射状カラーパレット
   - 中心: 守護色（二重線八角形）
   - 周囲: エネルギーUP色6種（八角形）
   - タブー色（三角形）

3. **中央下部**
   - タブー色（薬色）の解説

4. **フッター左側**
   - インテリアアドバイス

5. **フッター右側**
   - 年間ラッキーカラー（白抜き八角形）
   - 年間タブーカラー（白抜き三角形）

### 色の表示形状
- 八角形: 守護色、エネルギーUP色6種、ラッキーカラー
- 三角形: タブー色、年間タブーカラー

## 技術スタック

- TypeScript + React (TanStack Router)
- kiso.css v1.2.3 (ベーススタイリング)
- Panda CSS (コンポーネントスタイリング・デザイントークン)
- lucide-react (アイコン)
- Valibot (バリデーション・型定義)
- Bun
- Cloudflare Workers
- Vitest (テスト)

## 画面フロー

1. **入力画面**: 12パターンから1つ選択
2. **プレビュー画面**: A4鑑定書の印刷プレビュー
3. **完了画面**: 印刷完了メッセージ

## 実装タスク（全25タスク、7時間45分）

### フェーズ1: 準備・基礎構築（7タスク）

#### T1-0: Panda CSSセットアップ - 30分
- `panda init` 実行、設定ファイル作成
- 実装計画に基づくカラーパレットのトークン定義（`theme.tokens.colors`）
- CSSレイヤー設定（`@layer base { @import "kiso.css"; }`）
- `styled-system` ディレクトリをBiomeの対象外に設定

#### T1-1: TypeScript型定義（基本） - 15分
- `AppraisalPattern`, `EnergyUpColor`, `TabooColor`, `InteriorAdvice` 定義
- `AppraisalReport` 基本型
- 色名リテラル型（`"ピンク" | "ワイン" | ...`）

#### T1-2: TypeScript型定義（高度） - 15分
- URLパラメータ設計（`/preview?patternId=5` 形式）
- ユーティリティ型、型定義の拡張

#### T1-3: 12パターンデータ入力（色） - 30分
- エネルギーUP色（6種×12パターン）
- タブー色（6色）

#### T1-4: 12パターンデータ入力（アドバイス） - 15分
- インテリアアドバイス（12パターン）

#### T1-5: 色コード定義 - 15分
- 各色名のHexコードを `panda.config.ts` のトークンとして実装
- 型定義を生成（`panda codegen`）
- 印刷用カラーパレット作成

#### T1-6: ルーティング構築 - 15分
- TanStack Routerの3ルート定義
- URLパラメータ型追加

---

### フェーズ2: 基本UI実装（6タスク）

#### T2-1: 入力画面基本レイアウト - 15分
- 12カードグリッド（モバイル1カラム）
- 各カード: パターン番号、エネルギーが落ちる年、主要な色の表示

#### T2-2: 入力画面スタイリング - 15分
- Panda CSSの `css()` 関数や `Stack`, `Grid` パターンを使用したカードデザイン
- ホバー効果、タッチサイズ確保
- 色見本の表示（八角形アイコンなど）

#### T2-3: 入力画面レスポンシブ - 30分
- モバイル2カラム、PC 3-4カラム対応

#### T2-4: 完了画面実装 - 15分
- メッセージ、ボタン、アニメーション

#### T2-5: プレビュー画面レイアウト - 15分
- 戻るボタン、A4プレビューエリア、印刷ボタン配置

#### T2-6: プレビュー画面スタイリング - 15分
- Panda CSSの `_print` モディファイアを活用したボタンデザイン
- A4プレビュー枠、ピンチ対応

---

### フェーズ3: 鑑定書実装（6タスク）

#### T3-1: 鑑定書基本構造 - 15分
- A4用紙レイアウト、セクション分割
- ヘッダー（タイトル、氏名・生年月日、十二支アイコン）
- メインパレットエリア
- フッター（インテリアアドバイス、年間カラー）

#### T3-2: 手書きスペース（ヘッダー） - 15分
- 氏名・生年月日の下線エリア
- 十二支八角形枠内の入力スペース

#### T3-3: カラーパレットSVGコンポーネント - 45分
- 放射状レイアウト（守護色を中心とした八角形パレット）
- 守護色: 二重線八角形（中央）
- エネルギーUP色6種: 八角形（周囲）
- タブー色: 三角形
- 座標計算と中央配置の調整
- SVG内の要素配置（絶対座標）以外の、コンテナのレイアウトやマージン制御に Panda CSS を適用

#### T3-4: 八角形・三角形SVG実装 - 10分
- 八角形SVGコンポーネント（サイズバリエーション）
- 三角形SVGコンポーネント
- 色の動的適用

#### T3-5: 自動生成項目配置 - 20分
- パターン番号、エネルギー落ちる年
- インテリアアドバイス（箇条書き対応）
- タブー色の注釈（薬色の説明）定数データ

#### T3-6: 手書きスペース（年間カラー） - 15分
- 「202 [ ] 年」入力スペース
- 白抜き八角形（ラッキーカラー）
- 白抜き三角形（タブーカラー）

---

### フェーズ4: 機能完成・調整（6タスク）

#### T4-1: 印刷用CSS基礎 - 15分
- `@media print`設定、A4縦固定
- フォント指定（serif系で説得力向上）

#### T4-2: 印刷用CSS要素制御 - 15分
- ヘッダー/フッター/ボタン非表示、印刷エリアのみ表示

#### T4-3: 印刷用CSS詳細調整 - 15分
- 余白制御、改ページ防止、インク節約設定、モバイル対応

#### T4-4: 印刷機能実装 - 15分
- 印刷ボタン→`window.print()`、完了画面遷移

#### T4-5: レスポンシブ最適化 - 15分
- タッチサイズ44px+、モバイルUI微調整

#### T4-6: 検証・微調整 - 30分
- 各種端末印刷テスト、不具合修正

---

## 付録

### 色のHexコード定義

| 色名 | Hexコード | 選定理由 |
| :--- | :--- | :--- |
| ピンク | #E91E63 | 落ち着いたピンク、マゼンタ控えめ |
| ブラウン | #795548 | 安定した茶色 |
| パープル | #9C27B0 | 高貴な印象、青寄りすぎない |
| イエロー | #FBC02D | 山吹色寄り、視認性確保 |
| レッド | #D32F2F | 適度な深み、インク節約 |
| ワイン | #880E4F | 高級感ある深い赤紫 |
| ベージュ | #F5F5DC | パレットとして認識可能な濃さ |
| ネイビーブルー | #1A237E | 知性的、黒に近い青味 |
| ブラック | #212121 | リッチブラックで目に優しい |
| ブルー | #1976D2 | 清潔感、くすみにくい |
| グリーン | #388E3C | 自然な緑、目に優しい |
| ディープグリーン | #1B5E20 | 深い森の落ち着き |
| グレー | #757575 | 中立的 |
| イエローグリーン | #7CB342 | 若々しい芽吹き |

### 印刷用CSSサンプル

```css
@media print {
  /* 不要な要素の非表示 */
  header,
  footer,
  nav,
  button,
  .no-print {
    display: none !important;
  }

  /* A4サイズと余白の制御 */
  @page {
    size: A4 portrait;
    margin: 15mm;
  }

  /* 背景と色の強制表示 */
  body {
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
    background: #ffffff !important;
    color: #000000 !important;
    font-size: 12pt;
    line-height: 1.5;
  }

  /* レイアウト調整 */
  .container {
    width: 100% !important;
    margin: 0 !important;
    padding: 0 !important;
    box-shadow: none !important;
  }

  /* カラーパレットの表示 */
  .color-swatch {
    border: 1px solid #ddd;
    height: 50px;
    print-color-adjust: exact;
  }

  /* リンクの処理 */
  a {
    text-decoration: none;
    color: black;
  }
  a::after {
    content: "" !important;
  }
}
```

### モバイル印刷対応のポイント

- **iOS Safari**: `@page` の `margin` 設定が無視されるため、`body` に対して `padding` を設定
- **Android Chrome**: `print-color-adjust: exact` を指定しないとカラーパレットが白抜きになる

### Panda CSS設定サンプル

#### panda.config.ts

```typescript
import { defineConfig } from "@pandacss/dev";

export default defineConfig({
  preflight: false,
  include: ["./src/**/*.{ts,tsx}"],
  exclude: [],
  outdir: "styled-system",
  theme: {
    extend: {
      tokens: {
        colors: {
          // エネルギーUP色
          pink: { value: "#E91E63" },
          brown: { value: "#795548" },
          purple: { value: "#9C27B0" },
          yellow: { value: "#FBC02D" },
          red: { value: "#D32F2F" },
          wine: { value: "#880E4F" },
          // その他の色
          beige: { value: "#F5F5DC" },
          navyBlue: { value: "#1A237E" },
          black: { value: "#212121" },
          blue: { value: "#1976D2" },
          green: { value: "#388E3C" },
          deepGreen: { value: "#1B5E20" },
          gray: { value: "#757575" },
          yellowGreen: { value: "#7CB342" },
        },
      },
    },
  },
  globalCss: {
    body: {
      margin: 0,
    },
  },
});
```

#### src/index.css

```css
@layer base {
  @import "kiso.css";
}

/* Panda CSSの生成スタイル */
@layer panda;
```

#### Biome設定 (biome.jsonc)

```jsonc
{
  "$schema": "https://biomejs.dev/schemas/1.8.3/schema.json",
  "files": {
    "ignore": [
      "styled-system",  // Panda CSS生成ファイルを除外
      "node_modules"
    ]
  }
}
```

---

## 参考

- [業務仕様](./business-requirements.md)
- [要件](./requirements.md)
- [現行仕様PDF](./現行仕様.pdf)

## PDF解析結果の要点

### レイアウト構造
- ヘッダー: 顧客基本情報（氏名、生年月日）＋十二支アイコン
- 中央メイン部: 守護色を中心とした放射状のカラーパレット
- 中央下部: タブー色の説明
- フッター左側: インテリアアドバイス
- フッター右側: 年間ラッキー・タブーカラー

### 色の表示方法
- 基本形状: 八角形（オクタゴン）
- 中心（守護色）: 最も大きな二重線八角形
- 周囲（目的別カラー）: 守護色を囲む6つの八角形
- タブー色: 三角形

### 手書きスペース
- 氏名・生年月日: 上部の下線部
- 十二支: 右上八角形内のハイフン部分
- 年間カラー: 「202 [ ] 年」の空欄、八角形・三角形の枠内
